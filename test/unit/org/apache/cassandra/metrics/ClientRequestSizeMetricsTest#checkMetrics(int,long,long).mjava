    private void checkMetrics(int numberOfRequests, long requestLength, long responseLength)
    {
        Snapshot snapshot;
        long expectedTotalBytesRead = numberOfRequests * requestLength;
        assertEquals(expectedTotalBytesRead, ClientRequestSizeMetrics.totalBytesRead.getCount());

        long expectedTotalBytesWritten = numberOfRequests * responseLength;
        assertEquals(expectedTotalBytesWritten, ClientRequestSizeMetrics.totalBytesWritten.getCount());

        // The request fit in one single frame so we know the new number of received frames
        assertEquals(numberOfRequests, ClientRequestSizeMetrics.bytesReceivedPerFrame.getCount());

        snapshot = ClientRequestSizeMetrics.bytesReceivedPerFrame.getSnapshot();
        assertMin(snapshot, requestLength);
        assertMax(snapshot, requestLength);

        // The response fit in one single frame so we know the new number of received frames
        assertEquals(numberOfRequests, ClientRequestSizeMetrics.bytesTransmittedPerFrame.getCount());

        snapshot = ClientRequestSizeMetrics.bytesTransmittedPerFrame.getSnapshot();
        assertMin(snapshot, responseLength);
        assertMax(snapshot, responseLength);
    }


    @Test
    public void testRecoverCounter() throws IOException, ExecutionException, InterruptedException
    {
        Table table1 = Table.open("Keyspace1");

        RowMutation rm;
        DecoratedKey dk = Util.dk("key");
        ColumnFamily cf;

        for (int i = 0; i < 10; ++i)
        {
            rm = new RowMutation("Keyspace1", dk.key);
            cf = ColumnFamily.create("Keyspace1", "Counter1");
            cf.addColumn(new CounterColumn(ByteBufferUtil.bytes("col"), 1L, 1L));
            rm.add(cf);
            rm.apply();
        }

        table1.getColumnFamilyStore("Counter1").clearUnsafe();

        CommitLog.instance.resetUnsafe(); // disassociate segments from live CL
        CommitLog.recover();

        cf = Util.getColumnFamily(table1, dk, "Counter1");

        assert cf.getColumnCount() == 1;
        IColumn c = cf.getColumn(ByteBufferUtil.bytes("col"));

        assert c != null;
        assert ((CounterColumn)c).total() == 10L;
    }


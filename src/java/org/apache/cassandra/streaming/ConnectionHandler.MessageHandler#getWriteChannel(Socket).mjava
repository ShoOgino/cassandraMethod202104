        protected static WritableByteChannel getWriteChannel(Socket socket) throws IOException
        {
            WritableByteChannel out = socket.getChannel();
            // socket channel is null when encrypted(SSL)
            return out == null
                 ? Channels.newChannel(socket.getOutputStream())
                 : out;
        }

